version: '2'

services:
    code:
        image: eraac/xxx
        volumes:
            - "./config/code/parameters.yml:/var/www/symfony/app/config/parameters.yml:ro"
            - "./logs/code:/var/www/symfony/var/logs"

    php:
        image: dinamic/docker-alpine-php7
        expose:
            - "9000"
        links:
            - code
        external_links:
            - mysql
            - fake-smtp
        volumes_from:
            - code
        networks:
            - fake-smtp
            - mysql
            - default
        labels:
            - "traefik.enable=false"

    nginx:
        image: eraac/nginx
        environment:
            - VIRTUAL_HOST=domain.tld
            - VIRTUAL_NETWORK=reverse-proxy
            - VIRTUAL_PORT=80
            - LETSENCRYPT_HOST=domain.tld
            - LETSENCRYPT_EMAIL=contact@domain.tld
        labels:
            - "traefik.backend=app-name"
            - "traefik.frontend.rule=Host:domain.tld"
            - "traefik.port=80"
            - "traefik.docker.network=reverse-proxy"
            - "traefik.enable=true"
        links:
            - php
            - code
        volumes:
            - "./logs/nginx/:/var/log/nginx"
            - "./config/nginx/symfony.conf:/etc/nginx/conf.d/symfony.conf:ro"
        volumes_from:
            - code
        networks:
            - reverse-proxy
            - default

networks:
    mysql:
        external: true
    fake-smtp:
        external: true
    reverse-proxy:
        external: true
